{"version":3,"sources":["../../src/common/Game.js"],"names":["PADDING","WIDTH","HEIGHT","PADDLE_WIDTH","PADDLE_HEIGHT","Paddle","gameEngine","options","props","other","health","Object","assign","type","BaseTypes","TYPES","INT16","DynamicObject","Ball","velocity","percent","Game","physicsEngine","SimplePhysicsEngine","on","gameLogic","bind","serverSideInit","serverSidePlayerJoined","serverSidePlayerDisconnected","clientSideInit","clientSideDraw","serializer","registerClass","YourGameObject","paddles","world","queryObjects","instanceType","ball","queryObject","length","position","x","y","console","log","inputData","playerId","playerPaddle","input","addObjectToWorld","TwoVector","ev","id","controls","KeyboardControls","renderer","clientEngine","bindKey","repeat","updateEl","el","obj","style","top","left","background","toString","document","querySelector","GameEngine"],"mappings":";;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAMA,OAAO,GAAG,EAAhB;AACA,IAAMC,KAAK,GAAG,GAAd;AACA,IAAMC,MAAM,GAAG,GAAf;AACA,IAAMC,YAAY,GAAG,EAArB;AACA,IAAMC,aAAa,GAAG,EAAtB;;IAEMC,M;;;;;AAEF,kBAAYC,UAAZ,EAAwBC,OAAxB,EAAiCC,KAAjC,EAAwC;AAAA;;AAAA,+EAC9BF,UAD8B,EAClBC,OADkB,EACTC,KADS;AAEvC;;;;2BAQMC,K,EAAO;AACV,yEAAaA,KAAb;;AACA,WAAKC,MAAL,GAAcD,KAAK,CAACC,MAApB;AACH;;;wBATsB;AACnB,aAAOC,MAAM,CAACC,MAAP,CAAc;AACjBF,QAAAA,MAAM,EAAE;AAAEG,UAAAA,IAAI,EAAEC,mBAAUC,KAAV,CAAgBC;AAAxB;AADS,OAAd,mDAAP;AAGH;;;;EAVgBC,sB;;IAkBfC,I;;;;;AAEF,gBAAYZ,UAAZ,EAAwBC,OAAxB,EAAiCC,KAAjC,EAAwC;AAAA;;AAAA,6EAC9BF,UAD8B,EAClBC,OADkB,EACTC,KADS;AAEvC,G,CAED;;;;;2BAKOC,K,EAAO;AACV,uEAAaA,KAAb;AACH;;;wBANa;AACV,aAAO;AAAEU,QAAAA,QAAQ,EAAE;AAAEC,UAAAA,OAAO,EAAE;AAAX;AAAZ,OAAP;AACH;;;;EATcH,sB,GAiBnB;AACA;AACA;AACA;AACA;;;IACqBI,I;;;;;AAEjB,gBAAYd,OAAZ,EAAqB;AAAA;;AAAA;;AACjB,8EAAMA,OAAN;AACA,UAAKe,aAAL,GAAqB,IAAIC,4BAAJ,CAAwB;AAAEjB,MAAAA,UAAU;AAAZ,KAAxB,CAArB,CAFiB,CAIjB;;AACA,UAAKkB,EAAL,CAAQ,UAAR,EAAoB,MAAKC,SAAL,CAAeC,IAAf,+BAApB,EALiB,CAOjB;;;AACA,UAAKF,EAAL,CAAQ,cAAR,EAAwB,MAAKG,cAAL,CAAoBD,IAApB,+BAAxB;;AACA,UAAKF,EAAL,CAAQ,sBAAR,EAAgC,MAAKI,sBAAL,CAA4BF,IAA5B,+BAAhC;;AACA,UAAKF,EAAL,CAAQ,4BAAR,EAAsC,MAAKK,4BAAL,CAAkCH,IAAlC,+BAAtC,EAViB,CAYjB;;;AACA,UAAKF,EAAL,CAAQ,uBAAR,EAAiC,MAAKM,cAAL,CAAoBJ,IAApB,+BAAjC;;AACA,UAAKF,EAAL,CAAQ,cAAR,EAAwB,MAAKO,cAAL,CAAoBL,IAApB,+BAAxB;;AAdiB;AAepB;;;;oCAEeM,U,EAAY;AACxBA,MAAAA,UAAU,CAACC,aAAX,CAAyBC,cAAzB;AACH;;;gCAEW;AACR,UAAIC,OAAO,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAEjC;AAAhB,OAAxB,CAAd;AACA,UAAIkC,IAAI,GAAG,KAAKH,KAAL,CAAWI,WAAX,CAAuB;AAAEF,QAAAA,YAAY,EAAEpB;AAAhB,OAAvB,CAAX;AACA,UAAI,CAACqB,IAAD,IAASJ,OAAO,CAACM,MAAR,KAAmB,CAAhC,EAAmC,OAH3B,CAKR;;AACA,UAAIF,IAAI,CAACG,QAAL,CAAcC,CAAd,IAAmB3C,OAAO,GAAGG,YAA7B,IACAoC,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmBT,OAAO,CAAC,CAAD,CAAP,CAAWS,CAD9B,IACmCL,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmBT,OAAO,CAAC,CAAD,CAAP,CAAWO,QAAX,CAAoBE,CAApB,GAAwBxC,aAD9E,IAEAmC,IAAI,CAACpB,QAAL,CAAcwB,CAAd,GAAkB,CAFtB,EAEyB;AAErB;AACAJ,QAAAA,IAAI,CAACpB,QAAL,CAAcwB,CAAd,IAAmB,CAAC,CAApB;AACAJ,QAAAA,IAAI,CAACG,QAAL,CAAcC,CAAd,GAAkB3C,OAAO,GAAGG,YAAV,GAAyB,CAA3C;AACH,OAPD,MAOO,IAAIoC,IAAI,CAACG,QAAL,CAAcC,CAAd,IAAmB,CAAvB,EAA0B;AAE7B;AACAJ,QAAAA,IAAI,CAACpB,QAAL,CAAcwB,CAAd,IAAmB,CAAC,CAApB;AACAJ,QAAAA,IAAI,CAACG,QAAL,CAAcC,CAAd,GAAkB,CAAlB;AACAE,QAAAA,OAAO,CAACC,GAAR;AACAX,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAWzB,MAAX;AACH,OApBO,CAsBR;;;AACA,UAAI6B,IAAI,CAACG,QAAL,CAAcC,CAAd,IAAmB1C,KAAK,GAAGD,OAAR,GAAkBG,YAArC,IACAoC,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmBT,OAAO,CAAC,CAAD,CAAP,CAAWO,QAAX,CAAoBE,CADvC,IAC4CL,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmBT,OAAO,CAAC,CAAD,CAAP,CAAWO,QAAX,CAAoBE,CAApB,GAAwBxC,aADvF,IAEAmC,IAAI,CAACpB,QAAL,CAAcwB,CAAd,GAAkB,CAFtB,EAEyB;AAErB;AACAJ,QAAAA,IAAI,CAACpB,QAAL,CAAcwB,CAAd,IAAmB,CAAC,CAApB;AACAJ,QAAAA,IAAI,CAACG,QAAL,CAAcC,CAAd,GAAkB1C,KAAK,GAAGD,OAAR,GAAkBG,YAAlB,GAAiC,CAAnD;AACH,OAPD,MAOO,IAAIoC,IAAI,CAACG,QAAL,CAAcC,CAAd,IAAmB1C,KAAvB,EAA+B;AAElC;AACAsC,QAAAA,IAAI,CAACpB,QAAL,CAAcwB,CAAd,IAAmB,CAAC,CAApB;AACAJ,QAAAA,IAAI,CAACG,QAAL,CAAcC,CAAd,GAAkB1C,KAAK,GAAG,CAA1B;AACA4C,QAAAA,OAAO,CAACC,GAAR;AACAX,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAWzB,MAAX;AACH,OArCO,CAuCR;;;AACA,UAAI6B,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmB,CAAvB,EAA0B;AACtBL,QAAAA,IAAI,CAACG,QAAL,CAAcE,CAAd,GAAkB,CAAlB;AACAL,QAAAA,IAAI,CAACpB,QAAL,CAAcyB,CAAd,IAAmB,CAAC,CAApB;AACH,OAHD,MAGO,IAAIL,IAAI,CAACG,QAAL,CAAcE,CAAd,IAAmB1C,MAAvB,EAA+B;AAClCqC,QAAAA,IAAI,CAACG,QAAL,CAAcE,CAAd,GAAkB1C,MAAM,GAAG,CAA3B;AACAqC,QAAAA,IAAI,CAACpB,QAAL,CAAcyB,CAAd,IAAmB,CAAC,CAApB;AACH;AACJ;;;iCAEYG,S,EAAWC,Q,EAAU;AAC9B,6EAAmBD,SAAnB,EAA8BC,QAA9B,EAD8B,CAG9B;;;AACA,UAAIC,YAAY,GAAG,KAAKb,KAAL,CAAWI,WAAX,CAAuB;AAAEQ,QAAAA,QAAQ,EAARA;AAAF,OAAvB,CAAnB;;AACA,UAAIC,YAAJ,EAAkB;AACd,YAAIF,SAAS,CAACG,KAAV,KAAoB,IAAxB,EAA8B;AAC1BD,UAAAA,YAAY,CAACP,QAAb,CAAsBE,CAAtB,IAA2B,CAA3B;AACH,SAFD,MAEO,IAAIG,SAAS,CAACG,KAAV,KAAoB,MAAxB,EAAgC;AACnCD,UAAAA,YAAY,CAACP,QAAb,CAAsBE,CAAtB,IAA2B,CAA3B;AACH;AACJ;AACJ,K,CAGD;AACA;AACA;AACA;AACA;;;;qCACiB;AAEb;AACA,WAAKO,gBAAL,CAAsB,IAAI9C,MAAJ,CAAW,IAAX,EAAiB,IAAjB,EAAuB;AAAEqC,QAAAA,QAAQ,EAAE,IAAIU,kBAAJ,CAAcpD,OAAd,EAAuB,CAAvB;AAAZ,OAAvB,CAAtB;AACA,WAAKmD,gBAAL,CAAsB,IAAI9C,MAAJ,CAAW,IAAX,EAAiB,IAAjB,EAAuB;AAAEqC,QAAAA,QAAQ,EAAE,IAAIU,kBAAJ,CAAcnD,KAAK,GAAGD,OAAtB,EAA+B,CAA/B;AAAZ,OAAvB,CAAtB;AACA,WAAKmD,gBAAL,CAAsB,IAAIjC,IAAJ,CAAS,IAAT,EAAe,IAAf,EAAqB;AACvCwB,QAAAA,QAAQ,EAAE,IAAIU,kBAAJ,CAAcnD,KAAK,GAAE,CAArB,EAAwBC,MAAM,GAAG,CAAjC,CAD6B;AAEvCiB,QAAAA,QAAQ,EAAE,IAAIiC,kBAAJ,CAAc,CAAd,EAAiB,CAAjB;AAF6B,OAArB,CAAtB;AAKH,K,CAED;;;;2CACuBC,E,EAAI;AACvB,UAAIlB,OAAO,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAEjC;AAAhB,OAAxB,CAAd;;AACA,UAAI8B,OAAO,CAAC,CAAD,CAAP,CAAWa,QAAX,KAAwB,CAA5B,EAA+B;AAC3Bb,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAWa,QAAX,GAAsBK,EAAE,CAACL,QAAzB;AACH,OAFD,MAEO,IAAIb,OAAO,CAAC,CAAD,CAAP,CAAWa,QAAX,KAAwB,CAA5B,EAA+B;AAClCb,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAWa,QAAX,GAAsBK,EAAE,CAACL,QAAzB;AACH;AACJ;;;iDAE4BK,E,EAAI;AAC7B,UAAIlB,OAAO,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAEjC;AAAhB,OAAxB,CAAd;;AACA,UAAI8B,OAAO,CAAC,CAAD,CAAP,CAAWa,QAAX,KAAwBK,EAAE,CAACC,EAA/B,EAAmC;AAC/BnB,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAWa,QAAX,GAAsB,CAAtB;AACH,OAFD,MAEO,IAAIb,OAAO,CAAC,CAAD,CAAP,CAAWa,QAAX,KAAwBK,EAAE,CAACC,EAA/B,EAAmC;AACtCnB,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAWa,QAAX,GAAsB,CAAtB;AACH;AACJ,K,CAGD;AACA;AACA;AACA;AACA;;;;qCACiB;AACb,WAAKO,QAAL,GAAgB,IAAIC,yBAAJ,CAAqB,KAAKC,QAAL,CAAcC,YAAnC,CAAhB;AACA,WAAKH,QAAL,CAAcI,OAAd,CAAsB,IAAtB,EAA4B,IAA5B,EAAkC;AAAEC,QAAAA,MAAM,EAAE;AAAV,OAAlC;AACA,WAAKL,QAAL,CAAcI,OAAd,CAAsB,MAAtB,EAA8B,MAA9B,EAAsC;AAAEC,QAAAA,MAAM,EAAE;AAAV,OAAtC;AACH;;;qCAEgB;AAEb,eAASC,QAAT,CAAkBC,EAAlB,EAAsBC,GAAtB,EAA2B;AACvB,YAAIrD,MAAM,GAAGqD,GAAG,CAACrD,MAAJ,GAAW,CAAX,GAAaqD,GAAG,CAACrD,MAAjB,GAAwB,EAArC;AACAoD,QAAAA,EAAE,CAACE,KAAH,CAASC,GAAT,GAAeF,GAAG,CAACrB,QAAJ,CAAaE,CAAb,GAAiB,EAAjB,GAAsB,IAArC;AACAkB,QAAAA,EAAE,CAACE,KAAH,CAASE,IAAT,GAAgBH,GAAG,CAACrB,QAAJ,CAAaC,CAAb,GAAiB,IAAjC;AACAmB,QAAAA,EAAE,CAACE,KAAH,CAASG,UAAT,gBAA4BzD,MAAM,CAAC0D,QAAP,CAAgB,EAAhB,CAA5B,cAAmD1D,MAAM,CAAC0D,QAAP,CAAgB,EAAhB,CAAnD;AACH;;AAED,UAAIjC,OAAO,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAEjC;AAAhB,OAAxB,CAAd;AACA,UAAIkC,IAAI,GAAG,KAAKH,KAAL,CAAWI,WAAX,CAAuB;AAAEF,QAAAA,YAAY,EAAEpB;AAAhB,OAAvB,CAAX;AACA,UAAI,CAACqB,IAAD,IAASJ,OAAO,CAACM,MAAR,KAAmB,CAAhC,EAAmC;AACnCoB,MAAAA,QAAQ,CAACQ,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAD,EAAkC/B,IAAlC,CAAR;AACAsB,MAAAA,QAAQ,CAACQ,QAAQ,CAACC,aAAT,CAAuB,UAAvB,CAAD,EAAqCnC,OAAO,CAAC,CAAD,CAA5C,CAAR;AACA0B,MAAAA,QAAQ,CAACQ,QAAQ,CAACC,aAAT,CAAuB,UAAvB,CAAD,EAAqCnC,OAAO,CAAC,CAAD,CAA5C,CAAR;AACH;;;;EAtJ6BoC,mB","sourcesContent":["import { GameEngine, BaseTypes, DynamicObject, SimplePhysicsEngine, TwoVector, KeyboardControls } from 'lance-gg';\r\n\r\n// /////////////////////////////////////////////////////////\r\n//\r\n// GAME OBJECTS\r\n//\r\n// /////////////////////////////////////////////////////////\r\nconst PADDING = 20;\r\nconst WIDTH = 400;\r\nconst HEIGHT = 400;\r\nconst PADDLE_WIDTH = 10;\r\nconst PADDLE_HEIGHT = 50;\r\n\r\nclass Paddle extends DynamicObject {\r\n\r\n    constructor(gameEngine, options, props) {\r\n        super(gameEngine, options, props);\r\n    }\r\n\r\n    static get netScheme() {\r\n        return Object.assign({\r\n            health: { type: BaseTypes.TYPES.INT16 }\r\n        }, super.netScheme);\r\n    }\r\n\r\n    syncTo(other) {\r\n        super.syncTo(other);\r\n        this.health = other.health;\r\n    }\r\n}\r\n\r\nclass Ball extends DynamicObject {\r\n\r\n    constructor(gameEngine, options, props) {\r\n        super(gameEngine, options, props);\r\n    }\r\n\r\n    // avoid gradual synchronization of velocity\r\n    get bending() {\r\n        return { velocity: { percent: 0.0 } };\r\n    }\r\n\r\n    syncTo(other) {\r\n        super.syncTo(other);\r\n    }\r\n}\r\n\r\n\r\n// /////////////////////////////////////////////////////////\r\n//\r\n// GAME ENGINE\r\n//\r\n// /////////////////////////////////////////////////////////\r\nexport default class Game extends GameEngine {\r\n\r\n    constructor(options) {\r\n        super(options);\r\n        this.physicsEngine = new SimplePhysicsEngine({ gameEngine: this });\r\n\r\n        // common code\r\n        this.on('postStep', this.gameLogic.bind(this));\r\n\r\n        // server-only code\r\n        this.on('server__init', this.serverSideInit.bind(this));\r\n        this.on('server__playerJoined', this.serverSidePlayerJoined.bind(this));\r\n        this.on('server__playerDisconnected', this.serverSidePlayerDisconnected.bind(this));\r\n\r\n        // client-only code\r\n        this.on('client__rendererReady', this.clientSideInit.bind(this));\r\n        this.on('client__draw', this.clientSideDraw.bind(this));\r\n    }\r\n\r\n    registerClasses(serializer) {\r\n        serializer.registerClass(YourGameObject);\r\n    }\r\n\r\n    gameLogic() {\r\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\r\n        let ball = this.world.queryObject({ instanceType: Ball });\r\n        if (!ball || paddles.length !== 2) return;\r\n\r\n        // CHECK LEFT EDGE:\r\n        if (ball.position.x <= PADDING + PADDLE_WIDTH &&\r\n            ball.position.y >= paddles[0].y && ball.position.y <= paddles[0].position.y + PADDLE_HEIGHT &&\r\n            ball.velocity.x < 0) {\r\n\r\n            // ball moving left hit player 1 paddle\r\n            ball.velocity.x *= -1;\r\n            ball.position.x = PADDING + PADDLE_WIDTH + 1;\r\n        } else if (ball.position.x <= 0) {\r\n\r\n            // ball hit left wall\r\n            ball.velocity.x *= -1;\r\n            ball.position.x = 0;\r\n            console.log(`player 2 scored`);\r\n            paddles[0].health--;\r\n        }\r\n\r\n        // CHECK RIGHT EDGE:\r\n        if (ball.position.x >= WIDTH - PADDING - PADDLE_WIDTH &&\r\n            ball.position.y >= paddles[1].position.y && ball.position.y <= paddles[1].position.y + PADDLE_HEIGHT &&\r\n            ball.velocity.x > 0) {\r\n\r\n            // ball moving right hits player 2 paddle\r\n            ball.velocity.x *= -1;\r\n            ball.position.x = WIDTH - PADDING - PADDLE_WIDTH - 1;\r\n        } else if (ball.position.x >= WIDTH ) {\r\n\r\n            // ball hit right wall\r\n            ball.velocity.x *= -1;\r\n            ball.position.x = WIDTH - 1;\r\n            console.log(`player 1 scored`);\r\n            paddles[1].health--;\r\n        }\r\n\r\n        // ball hits top or bottom edge\r\n        if (ball.position.y <= 0) {\r\n            ball.position.y = 1;\r\n            ball.velocity.y *= -1;\r\n        } else if (ball.position.y >= HEIGHT) {\r\n            ball.position.y = HEIGHT - 1;\r\n            ball.velocity.y *= -1;\r\n        }\r\n    }\r\n\r\n    processInput(inputData, playerId) {\r\n        super.processInput(inputData, playerId);\r\n\r\n        // get the player paddle tied to the player socket\r\n        let playerPaddle = this.world.queryObject({ playerId });\r\n        if (playerPaddle) {\r\n            if (inputData.input === 'up') {\r\n                playerPaddle.position.y -= 5;\r\n            } else if (inputData.input === 'down') {\r\n                playerPaddle.position.y += 5;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // /////////////////////////////////////////////////////////\r\n    //\r\n    // SERVER ONLY CODE\r\n    //\r\n    // /////////////////////////////////////////////////////////\r\n    serverSideInit() {\r\n\r\n        // create the paddle objects\r\n        this.addObjectToWorld(new Paddle(this, null, { position: new TwoVector(PADDING, 0) }));\r\n        this.addObjectToWorld(new Paddle(this, null, { position: new TwoVector(WIDTH - PADDING, 0) }));\r\n        this.addObjectToWorld(new Ball(this, null, {\r\n            position: new TwoVector(WIDTH /2, HEIGHT / 2),\r\n            velocity: new TwoVector(2, 2)\r\n        }));\r\n\r\n    }\r\n\r\n    // attach newly connected player to next available paddle\r\n    serverSidePlayerJoined(ev) {\r\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\r\n        if (paddles[0].playerId === 0) {\r\n            paddles[0].playerId = ev.playerId;\r\n        } else if (paddles[1].playerId === 0) {\r\n            paddles[1].playerId = ev.playerId;\r\n        }\r\n    }\r\n\r\n    serverSidePlayerDisconnected(ev) {\r\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\r\n        if (paddles[0].playerId === ev.id) {\r\n            paddles[0].playerId = 0;\r\n        } else if (paddles[1].playerId === ev.id) {\r\n            paddles[1].playerId = 0;\r\n        }\r\n    }\r\n\r\n\r\n    // /////////////////////////////////////////////////////////\r\n    //\r\n    // CLIENT ONLY CODE\r\n    //\r\n    // /////////////////////////////////////////////////////////\r\n    clientSideInit() {\r\n        this.controls = new KeyboardControls(this.renderer.clientEngine);\r\n        this.controls.bindKey('up', 'up', { repeat: true } );\r\n        this.controls.bindKey('down', 'down', { repeat: true } );\r\n    }\r\n\r\n    clientSideDraw() {\r\n\r\n        function updateEl(el, obj) {\r\n            let health = obj.health>0?obj.health:15;\r\n            el.style.top = obj.position.y + 10 + 'px';\r\n            el.style.left = obj.position.x + 'px';\r\n            el.style.background = `#ff${health.toString(16)}f${health.toString(16)}f`;\r\n        }\r\n\r\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\r\n        let ball = this.world.queryObject({ instanceType: Ball });\r\n        if (!ball || paddles.length !== 2) return;\r\n        updateEl(document.querySelector('.ball'), ball);\r\n        updateEl(document.querySelector('.paddle1'), paddles[0]);\r\n        updateEl(document.querySelector('.paddle2'), paddles[1]);\r\n    }\r\n}\r\n"],"file":"Game.js"}